<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="keywords" content="开发, 中文">
  <title>IndexedDB 2.0 更新了！</title>
  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.gravatar.com/avatar/c6f58a99408d7e443ce3c791eb0647ad?s=144">
  <link rel="shortcut icon" href="https://www.gravatar.com/avatar/c6f58a99408d7e443ce3c791eb0647ad?s=16" />
</head>
<body class="theme-base-08">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
        <img src="https://www.gravatar.com/avatar/c6f58a99408d7e443ce3c791eb0647ad?s=150"
             alt="gravatar" title="东方孤思子&lt;br&gt;Paris Qian Sen">
      
      <h2>东方孤思子<br>Paris Qian Sen</h2>
      <p class="lead">Profesional Coding<br>Simple Living<br>Creative Thinking</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="https://parisqian.com/">Blog</a></li>
      
      <li class="sidebar-nav-item"><a href="https://parisqian.com/about/">Who am I</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/qiansen1386"><i class="fa fa-github-square fa-2x"></i></a>
      
      <a href="http://stackexchange.com/users/1586938/paris-qian"><i class="fa fa-stack-overflow fa-2x"></i></a>
      <a href="https://sg.linkedin.com/in/parisqiansen"><i class="fa fa-linkedin-square fa-2x"></i></a>
      <a href="https://plus.google.com/&#43;Parisqiansen/posts"><i class="fa fa-google-plus-square fa-2x"></i></a>
      
      <a href="https://twitter.com/qiansen1386"><i class="fa fa-twitter-square fa-2x"></i></a>
      <a href="https://www.youtube.com/channel/UC1rGIQJUQABgRyA-edmRlKg"><i class="fa fa-youtube-square fa-2x"></i></a>
      <a href="https://parisqian.com/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-2x"></i></a>
      </li>
    </ul>

    

    <p><a href="https://parisqian.com/license/" class="copyright">Some Rights Reserved &copy; 2017</a><br>
      Proudly powered by <a href="https://gohugo.io">Hugo</a> <br>
      Theme: Customized <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
  </div>
</div>

<div class="content container">
  <div class="post">
    <h1 class="post-title">IndexedDB 2.0 更新了！</h1>
    <span class="post-date">Apr 26, 2017 &middot; <a href="https://parisqian.com/post/2017/04/indexeddb-2-0-is-now-supported#disqus_thread">Comments</a>
    <br/>
    <a class="label" href="https://parisqian.com/categories/%E5%BC%80%E5%8F%91">开发</a><a class="label" href="https://parisqian.com/categories/%E4%B8%AD%E6%96%87">中文</a>
    </span>
    

<h2 id="indexeddb-2-0-is-now-supported">IndexedDB 2.0 is now supported</h2>

<blockquote>
<p>IndexedDB 是一个浏览器内置的 NoSQL 底层实现，它允许你存储简单值以及结构化数据。不过即便是在 Mozilla 的手册上 （<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API" target="_blank">IndexedDB - Web API 接口 | MDN</a>）也是推荐使用第三方封装的库而非直接调用这个 API。Hacker News 上更是招来一片有关 API复杂，没有 SQL 功能的抱怨。这也就是为什么截止到 2017 四月 26 日。整个互联网上有关 IndexedDB 2.0 的中文内容是 0（A big flat zero）</p>
</blockquote>

<p>IndexedDB 就是一个简单的 NoSQL 实现，你可以在其上自行封装 API，甚至于封装一个 SQL 语法接口也未尝不可。</p>

<blockquote>
<p>题外话：因为所有 WebSQL 的实现背后都是 SQLite，所以委员会觉得这个提案已经不太可能进行标准化了。对于委员会的人来说，写一个 SQLite 的说明文件当标准，实在没有意义了。标准的价值就在于统筹多个实现，而因为只有一个实现，标准也就没有了价值。喜欢 SQLite 你就用 WebSQL 就行，反正不同实现的背后都是它。</p>
</blockquote>

<p>根据 <a href="https://www.chromestatus.com/feature/5812621622116352" target="_blank">Chrome 的功能状态日志</a> ，2.0 包括以下功能：
* Binary keys（二进制的键，准确讲是 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" target="_blank">Arraybuffer</a>、<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank">typed array objects</a>，和
 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DataView" target="_blank">DataView</a> 加索引）
* Object store（对象存储）
* index renaming（索引重命名）
* getKey() on IDBObjectStore
* getPrimaryKey() on IDBIndex</p>

<p>总体上而言是对旧 API 的补完，如果你不了解第一代，建议先把第一代用起来，因为第一代的浏览器支持已经很全面，甚至包括 IE10。而 2.0 的更新对数据库作者们而言更是喜大普奔，解决了一些之前的顽疾。期待有更多基于 IndexedDB 的好库涌现。如果你习惯 Mongo 或者 Firebase 这类 NoSQL 的话，直接用或自己做个简单封装也未尝不可。（不过话说他的 API 真的是炒鸡强大也炒鸡复杂）</p>

<blockquote>
<h4 id="mozilla-开发博客的-博文-1-摘要">Mozilla 开发博客的<a href="https://news.ycombinator.com/item?id=12793996" title="\[1\] What’s new in IndexedDB 2.0? | Hacker News（上文的吐槽）&quot;(https://news.ycombinator.com/item?id=12793996" target="_blank">博文</a>摘要</h4>

<h5 id="setters-to-idbobjectstore-name-and-idbindex-name">Setters to <code>IDBObjectStore.name</code> and <code>IDBIndex.name</code></h5>

<p>之前版本的 Index 你可以增减对象存储或索引的方式来升级数据架构，但是并不能重命名。基本上，这意味着你永远没法准确命名，因为随着时间的推移，很多东西的内在含义都可能会发生变化。而现在可以对数据库架构进行更好地升级修改：</p>
</blockquote>

<pre><code class="language-js">let request = indexedDB.open(&quot;messageDB&quot;, 2);
request.onupgradeneeded = (event) =&gt; {
  let txn = event.target.transaction;
  let store = txn.objectStore(&quot;text messages&quot;);

  store.name = &quot;mobile messages&quot;;
  let index = store.index(&quot;recipient&quot;);
  index.name = &quot;recipients&quot;;
};
</code></pre>

<blockquote>
<p>#####<code>IDBDatabase.onclose()</code>
新加了一个数据库的生命周期钩子 <code>close</code>。</p>
</blockquote>

<pre><code class="language-js">let request = indexedDB.open(&quot;bookstore&quot;);
request.onsuccess = (event) =&gt; {
  let db = event.target.result;

  db.onclose = (event) =&gt; {
    alert(&quot;the database: &quot; + db.name + &quot;was closed outside the script!&quot;);
  };
};
</code></pre>

<blockquote>
<p>。。。 更多内容请<a href="https://news.ycombinator.com/item?id=12793996" title="\[1\] What’s new in IndexedDB 2.0? | Hacker News（上文的吐槽）&quot;(https://news.ycombinator.com/item?id=12793996" target="_blank">参考原文（En）</a></p>
</blockquote>

<h4 id="浏览器支持">浏览器支持</h4>

<p>Firefox 51，Chrome 58，Opera release 45</p>

<h4 id="结语">结语</h4>

<p>有鉴于 Chrome 58 的开发公告中，着重提到了 IndexedDB 2.0 这里就简单解释下:<strong>是什么</strong>和<strong>为了什么</strong>。目的是为了帮助你了解这个规范背后的逻辑，或者你就当个新闻看也成。至于怎么用，请自行参考 MDN 的手册，或者去 <a href="https://github.com/search?utf8=%E2%9C%93&amp;q=indexedDB+Wrapper" target="_blank">github 上搜索 indexedDB Wrapper</a>。我因为还没有重度使用过它就不献丑了。</p>

<h4 id="ref">Ref:</h4>

<ul>
<li><a href="https://hacks.mozilla.org/2016/10/whats-new-in-indexeddb-2-0/" target="_blank">[0]  What’s new in IndexedDB 2.0? ★ Mozilla Hacks（原文）</a></li>
<li><a href="https://news.ycombinator.com/item?id=12793996" title="\[1\] What’s new in IndexedDB 2.0? | Hacker News（上文的吐槽）&quot;(https://news.ycombinator.com/item?id=12793996" target="_blank">[1] What’s new in IndexedDB 2.0? | Hacker News（上文的吐槽）</a></li>
<li><a href="https://w3c.github.io/IndexedDB/" target="_blank">[2]  Indexed Database API 2.0 - Editor’s Draft, 21 April 2017</a></li>
</ul>

  </div>
  <div id="disqus_thread"></div>
</div>
<script type="text/javascript">
var disqus_shortname = "qiansen1386";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
<script type="text/javascript">
    var disqus_shortname = "qiansen1386";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
<link rel="stylesheet" href="/css/poole.css">
<link rel="stylesheet" href="/css/hyde.css">
<link rel="stylesheet" href="/css/hyde-overrides.css" lazyload>
<link rel="stylesheet" href="/css/hyde-x.css" lazyload>
<link rel="stylesheet" href="/css/site.css" lazyload>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/styles/railscasts.min.css" lazyload>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" lazyload>


<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-47725881-1', 'auto');
    ga('send', 'pageview');
</script>


<script src="js/highlight.pack.js" async></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript">
var sc_project=9662348; 
var sc_invisible=0; 
var sc_security="e5e8f246";
document.write("<sc"+"ript type='text/javascript' src='https://secure.statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="shopify traffic
stats" href="https://statcounter.com/shopify/"
target="_blank"><img class="statcounter"
src="//c.statcounter.com/9662348/0/e5e8f246/0/" alt="shopify
traffic stats"></a></div></noscript>

</body>
</html>

